import { Component, HostBinding, Input, Output, EventEmitter, ChangeDetectionStrategy } from '@angular/core';
import { LoadingStrategy, GalleryItemType } from '../models/constants';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "./templates/gallery-image.component";
import * as i3 from "./templates/gallery-video.component";
import * as i4 from "./templates/gallery-iframe.component";
export class GalleryItemComponent {
    constructor(el, cd) {
        this.el = el;
        this.cd = cd;
        this.Types = GalleryItemType;
        /** A flag that ensure that the height was emitted after tbe image is loaded, used only for gallery image types */
        this.imageLoadingState = 'IN_PROGRESS';
        /** Stream that emits when an error occurs */
        this.error = new EventEmitter();
    }
    get isActive() {
        return this.index === this.currIndex;
    }
    get isIndexAttr() {
        return this.index;
    }
    get imageState() {
        return this.imageLoadingState;
    }
    get element() {
        return this.el.nativeElement;
    }
    get isAutoPlay() {
        if (this.isActive) {
            if (this.type === GalleryItemType.Video || this.type === GalleryItemType.Youtube) {
                return this.videoData.autoplay;
            }
        }
    }
    get youtubeSrc() {
        let autoplay = 0;
        if (this.isActive && this.type === GalleryItemType.Youtube && this.data.autoplay) {
            autoplay = 1;
        }
        const url = new URL(this.data.src);
        url.search = new URLSearchParams({
            wmode: 'transparent',
            ...this.data.params,
            autoplay
        }).toString();
        return url.href;
    }
    get load() {
        switch (this.config.loadingStrategy) {
            case LoadingStrategy.Preload:
                return true;
            case LoadingStrategy.Lazy:
                return this.currIndex === this.index;
            default:
                return this.currIndex === this.index || this.currIndex === this.index - 1 || this.currIndex === this.index + 1;
        }
    }
    get imageData() {
        return this.data;
    }
    get videoData() {
        return this.data;
    }
    ngAfterViewChecked() {
        const height = this.getHeight();
        this.element.style.setProperty('--g-item-width', `${this.getWidth()}px`);
        this.element.style.setProperty('--g-item-height', `${height}px`);
        if (this.currIndex === this.index) {
            // Auto-height feature, only allowed when sliding direction is horizontal
            const isThumbPositionHorizontal = this.config.thumbPosition === 'top' || this.config.thumbPosition === 'bottom';
            if (this.config.autoHeight && height && isThumbPositionHorizontal) {
                // Change slider height
                this.element.parentElement.parentElement.style.height = `${height}px`;
            }
        }
    }
    onItemLoaded() {
        if (this.imageLoadingState === 'IN_PROGRESS') {
            this.imageLoadingState = 'DONE';
            // Detect changes to re-calculate item size
            this.cd.detectChanges();
        }
    }
    getWidth() {
        if (this.config.slidingDirection === 'horizontal') {
            const firstElementChild = this.element?.firstElementChild;
            if (this.config.itemAutosize && this.imageLoadingState === 'DONE' && firstElementChild?.clientWidth) {
                return firstElementChild.clientWidth;
            }
        }
        return this.element.parentElement.parentElement.clientWidth;
    }
    getHeight() {
        const firstElementChild = this.element.firstElementChild;
        if (firstElementChild) {
            if (this.config.autoHeight) {
                if (this.imageLoadingState === 'DONE' && firstElementChild.clientHeight) {
                    return firstElementChild.clientHeight;
                }
            }
            if (this.config.slidingDirection === 'vertical') {
                if (this.config.itemAutosize && this.imageLoadingState === 'DONE' && firstElementChild.clientHeight) {
                    return firstElementChild.clientHeight;
                }
            }
        }
        return this.element.parentElement.parentElement.clientHeight;
    }
}
GalleryItemComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.1.0", ngImport: i0, type: GalleryItemComponent, deps: [{ token: i0.ElementRef }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
GalleryItemComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.1.0", type: GalleryItemComponent, selector: "gallery-item", inputs: { config: "config", index: "index", currIndex: "currIndex", type: "type", data: "data" }, outputs: { error: "error" }, host: { properties: { "class.g-active-item": "this.isActive", "attr.galleryIndex": "this.isIndexAttr", "attr.imageState": "this.imageState" } }, ngImport: i0, template: `
    <ng-container *ngIf="load" [ngSwitch]="type">
      <ng-container *ngSwitchCase="Types.Image">

        <gallery-image [src]="imageData.src"
                       [alt]="imageData.alt"
                       [loadingAttr]="config.loadingAttr"
                       [loadingIcon]="config.loadingIcon"
                       [loadingError]="config.loadingError"
                       (loaded)="onItemLoaded()"
                       (error)="error.emit($event)"></gallery-image>

        <div *ngIf="config.itemTemplate" class="g-template g-item-template">
          <ng-container *ngTemplateOutlet="config.itemTemplate; context: { index, type, data, isActive }">
          </ng-container>
        </div>

      </ng-container>

      <gallery-video *ngSwitchCase="Types.Video"
                     [src]="videoData.src"
                     [mute]="videoData.mute"
                     [poster]="videoData.poster"
                     [controls]="videoData.controls"
                     [controlsList]="videoData.controlsList"
                     [disablePictureInPicture]="videoData.disablePictureInPicture"
                     [play]="isAutoPlay"
                     [pause]="currIndex !== index"
                     (error)="error.emit($event)"></gallery-video>

      <gallery-iframe *ngSwitchCase="Types.Youtube"
                      [src]="youtubeSrc"
                      [autoplay]="isAutoPlay"
                      [loadingAttr]="config.loadingAttr"
                      [pause]="currIndex !== index"></gallery-iframe>

      <gallery-iframe *ngSwitchCase="Types.Iframe"
                      [src]="data.src"
                      [loadingAttr]="config.loadingAttr"></gallery-iframe>

      <ng-container *ngSwitchDefault>

        <div *ngIf="config.itemTemplate" class="g-template g-item-template">
          <ng-container *ngTemplateOutlet="config.itemTemplate; context: { index, type, data, isActive: isActive }">
          </ng-container>
        </div>

      </ng-container>
    </ng-container>
  `, isInline: true, dependencies: [{ kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i1.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "directive", type: i1.NgSwitch, selector: "[ngSwitch]", inputs: ["ngSwitch"] }, { kind: "directive", type: i1.NgSwitchCase, selector: "[ngSwitchCase]", inputs: ["ngSwitchCase"] }, { kind: "directive", type: i1.NgSwitchDefault, selector: "[ngSwitchDefault]" }, { kind: "component", type: i2.GalleryImageComponent, selector: "gallery-image", inputs: ["isThumbnail", "loadingAttr", "alt", "src", "loadingIcon", "loadingError", "errorIcon"], outputs: ["error", "loaded"] }, { kind: "component", type: i3.GalleryVideoComponent, selector: "gallery-video", inputs: ["src", "poster", "mute", "loop", "controls", "controlsList", "disableRemotePlayback", "disablePictureInPicture", "pause", "play"], outputs: ["error"] }, { kind: "component", type: i4.GalleryIframeComponent, selector: "gallery-iframe", inputs: ["src", "pause", "autoplay", "loadingAttr"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.1.0", ngImport: i0, type: GalleryItemComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'gallery-item',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    template: `
    <ng-container *ngIf="load" [ngSwitch]="type">
      <ng-container *ngSwitchCase="Types.Image">

        <gallery-image [src]="imageData.src"
                       [alt]="imageData.alt"
                       [loadingAttr]="config.loadingAttr"
                       [loadingIcon]="config.loadingIcon"
                       [loadingError]="config.loadingError"
                       (loaded)="onItemLoaded()"
                       (error)="error.emit($event)"></gallery-image>

        <div *ngIf="config.itemTemplate" class="g-template g-item-template">
          <ng-container *ngTemplateOutlet="config.itemTemplate; context: { index, type, data, isActive }">
          </ng-container>
        </div>

      </ng-container>

      <gallery-video *ngSwitchCase="Types.Video"
                     [src]="videoData.src"
                     [mute]="videoData.mute"
                     [poster]="videoData.poster"
                     [controls]="videoData.controls"
                     [controlsList]="videoData.controlsList"
                     [disablePictureInPicture]="videoData.disablePictureInPicture"
                     [play]="isAutoPlay"
                     [pause]="currIndex !== index"
                     (error)="error.emit($event)"></gallery-video>

      <gallery-iframe *ngSwitchCase="Types.Youtube"
                      [src]="youtubeSrc"
                      [autoplay]="isAutoPlay"
                      [loadingAttr]="config.loadingAttr"
                      [pause]="currIndex !== index"></gallery-iframe>

      <gallery-iframe *ngSwitchCase="Types.Iframe"
                      [src]="data.src"
                      [loadingAttr]="config.loadingAttr"></gallery-iframe>

      <ng-container *ngSwitchDefault>

        <div *ngIf="config.itemTemplate" class="g-template g-item-template">
          <ng-container *ngTemplateOutlet="config.itemTemplate; context: { index, type, data, isActive: isActive }">
          </ng-container>
        </div>

      </ng-container>
    </ng-container>
  `
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { config: [{
                type: Input
            }], index: [{
                type: Input
            }], currIndex: [{
                type: Input
            }], type: [{
                type: Input
            }], data: [{
                type: Input
            }], error: [{
                type: Output
            }], isActive: [{
                type: HostBinding,
                args: ['class.g-active-item']
            }], isIndexAttr: [{
                type: HostBinding,
                args: ['attr.galleryIndex']
            }], imageState: [{
                type: HostBinding,
                args: ['attr.imageState']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FsbGVyeS1pdGVtLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25nLWdhbGxlcnkvc3JjL2xpYi9jb21wb25lbnRzL2dhbGxlcnktaXRlbS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxXQUFXLEVBQ1gsS0FBSyxFQUNMLE1BQU0sRUFDTixZQUFZLEVBSVosdUJBQXVCLEVBQ3hCLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7Ozs7OztBQXlEdkUsTUFBTSxPQUFPLG9CQUFvQjtJQWtGL0IsWUFBb0IsRUFBYyxFQUFVLEVBQXFCO1FBQTdDLE9BQUUsR0FBRixFQUFFLENBQVk7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQWhGeEQsVUFBSyxHQUFHLGVBQWUsQ0FBQztRQUVqQyxrSEFBa0g7UUFDMUcsc0JBQWlCLEdBQTJCLGFBQWEsQ0FBQztRQWlCbEUsNkNBQTZDO1FBQ25DLFVBQUssR0FBRyxJQUFJLFlBQVksRUFBYyxDQUFDO0lBNERqRCxDQUFDO0lBMURELElBQXdDLFFBQVE7UUFDOUMsT0FBTyxJQUFJLENBQUMsS0FBSyxLQUFLLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDdkMsQ0FBQztJQUVELElBQXNDLFdBQVc7UUFDL0MsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDO0lBQ3BCLENBQUM7SUFFRCxJQUFvQyxVQUFVO1FBQzVDLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDO0lBQ2hDLENBQUM7SUFFRCxJQUFJLE9BQU87UUFDVCxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDO0lBQy9CLENBQUM7SUFFRCxJQUFJLFVBQVU7UUFDWixJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDakIsSUFBSSxJQUFJLENBQUMsSUFB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aURUOzJGQUVVLG9CQUFvQjtrQkF0RGhDLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLGNBQWM7b0JBQ3hCLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO29CQUMvQyxRQUFRLEVBQUU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FpRFQ7aUJBQ0Y7aUlBU1UsTUFBTTtzQkFBZCxLQUFLO2dCQUdHLEtBQUs7c0JBQWIsS0FBSztnQkFHRyxTQUFTO3NCQUFqQixLQUFLO2dCQUdHLElBQUk7c0JBQVosS0FBSztnQkFHRyxJQUFJO3NCQUFaLEtBQUs7Z0JBR0ksS0FBSztzQkFBZCxNQUFNO2dCQUVpQyxRQUFRO3NCQUEvQyxXQUFXO3VCQUFDLHFCQUFxQjtnQkFJSSxXQUFXO3NCQUFoRCxXQUFXO3VCQUFDLG1CQUFtQjtnQkFJSSxVQUFVO3NCQUE3QyxXQUFXO3VCQUFDLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgSG9zdEJpbmRpbmcsXG4gIElucHV0LFxuICBPdXRwdXQsXG4gIEV2ZW50RW1pdHRlcixcbiAgQWZ0ZXJWaWV3Q2hlY2tlZCxcbiAgRWxlbWVudFJlZixcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5XG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgR2FsbGVyeUNvbmZpZyB9IGZyb20gJy4uL21vZGVscy9jb25maWcubW9kZWwnO1xuaW1wb3J0IHsgTG9hZGluZ1N0cmF0ZWd5LCBHYWxsZXJ5SXRlbVR5cGUgfSBmcm9tICcuLi9tb2RlbHMvY29uc3RhbnRzJztcbmltcG9ydCB7IEdhbGxlcnlJdGVtRGF0YSwgSW1hZ2VJdGVtRGF0YSwgVmlkZW9JdGVtRGF0YSwgWW91dHViZUl0ZW1EYXRhIH0gZnJvbSAnLi90ZW1wbGF0ZXMvaXRlbXMubW9kZWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdnYWxsZXJ5LWl0ZW0nLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgdGVtcGxhdGU6IGBcbiAgICA8bmctY29udGFpbmVyICpuZ0lmPVwibG9hZFwiIFtuZ1N3aXRjaF09XCJ0eXBlXCI+XG4gICAgICA8bmctY29udGFpbmVyICpuZ1N3aXRjaENhc2U9XCJUeXBlcy5JbWFnZVwiPlxuXG4gICAgICAgIDxnYWxsZXJ5LWltYWdlIFtzcmNdPVwiaW1hZ2VEYXRhLnNyY1wiXG4gICAgICAgICAgICAgICAgICAgICAgIFthbHRdPVwiaW1hZ2VEYXRhLmFsdFwiXG4gICAgICAgICAgICAgICAgICAgICAgIFtsb2FkaW5nQXR0cl09XCJjb25maWcubG9hZGluZ0F0dHJcIlxuICAgICAgICAgICAgICAgICAgICAgICBbbG9hZGluZ0ljb25dPVwiY29uZmlnLmxvYWRpbmdJY29uXCJcbiAgICAgICAgICAgICAgICAgICAgICAgW2xvYWRpbmdFcnJvcl09XCJjb25maWcubG9hZGluZ0Vycm9yXCJcbiAgICAgICAgICAgICAgICAgICAgICAgKGxvYWRlZCk9XCJvbkl0ZW1Mb2FkZWQoKVwiXG4gICAgICAgICAgICAgICAgICAgICAgIChlcnJvcik9XCJlcnJvci5lbWl0KCRldmVudClcIj48L2dhbGxlcnktaW1hZ2U+XG5cbiAgICAgICAgPGRpdiAqbmdJZj1cImNvbmZpZy5pdGVtVGVtcGxhdGVcIiBjbGFzcz1cImctdGVtcGxhdGUgZy1pdGVtLXRlbXBsYXRlXCI+XG4gICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cImNvbmZpZy5pdGVtVGVtcGxhdGU7IGNvbnRleHQ6IHsgaW5kZXgsIHR5cGUsIGRhdGEsIGlzQWN0aXZlIH1cIj5cbiAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuXG4gICAgICA8Z2FsbGVyeS12aWRlbyAqbmdTd2l0Y2hDYXNlPVwiVHlwZXMuVmlkZW9cIlxuICAgICAgICAgICAgICAgICAgICAgW3NyY109XCJ2aWRlb0RhdGEuc3JjXCJcbiAgICAgICAgICAgICAgICAgICAgIFttdXRlXT1cInZpZGVvRGF0YS5tdXRlXCJcbiAgICAgICAgICAgICAgICAgICAgIFtwb3N0ZXJdPVwidmlkZW9EYXRhLnBvc3RlclwiXG4gICAgICAgICAgICAgICAgICAgICBbY29udHJvbHNdPVwidmlkZW9EYXRhLmNvbnRyb2xzXCJcbiAgICAgICAgICAgICAgICAgICAgIFtjb250cm9sc0xpc3RdPVwidmlkZW9EYXRhLmNvbnRyb2xzTGlzdFwiXG4gICAgICAgICAgICAgICAgICAgICBbZGlzYWJsZVBpY3R1cmVJblBpY3R1cmVdPVwidmlkZW9EYXRhLmRpc2FibGVQaWN0dXJlSW5QaWN0dXJlXCJcbiAgICAgICAgICAgICAgICAgICAgIFtwbGF5XT1cImlzQXV0b1BsYXlcIlxuICAgICAgICAgICAgICAgICAgICAgW3BhdXNlXT1cImN1cnJJbmRleCAhPT0gaW5kZXhcIlxuICAgICAgICAgICAgICAgICAgICAgKGVycm9yKT1cImVycm9yLmVtaXQoJGV2ZW50KVwiPjwvZ2FsbGVyeS12aWRlbz5cblxuICAgICAgPGdhbGxlcnktaWZyYW1lICpuZ1N3aXRjaENhc2U9XCJUeXBlcy5Zb3V0dWJlXCJcbiAgICAgICAgICAgICAgICAgICAgICBbc3JjXT1cInlvdXR1YmVTcmNcIlxuICAgICAgICAgICAgICAgICAgICAgIFthdXRvcGxheV09XCJpc0F1dG9QbGF5XCJcbiAgICAgICAgICAgICAgICAgICAgICBbbG9hZGluZ0F0dHJdPVwiY29uZmlnLmxvYWRpbmdBdHRyXCJcbiAgICAgICAgICAgICAgICAgICAgICBbcGF1c2VdPVwiY3VyckluZGV4ICE9PSBpbmRleFwiPjwvZ2FsbGVyeS1pZnJhbWU+XG5cbiAgICAgIDxnYWxsZXJ5LWlmcmFtZSAqbmdTd2l0Y2hDYXNlPVwiVHlwZXMuSWZyYW1lXCJcbiAgICAgICAgICAgICAgICAgICAgICBbc3JjXT1cImRhdGEuc3JjXCJcbiAgICAgICAgICAgICAgICAgICAgICBbbG9hZGluZ0F0dHJdPVwiY29uZmlnLmxvYWRpbmdBdHRyXCI+PC9nYWxsZXJ5LWlmcmFtZT5cblxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdTd2l0Y2hEZWZhdWx0PlxuXG4gICAgICAgIDxkaXYgKm5nSWY9XCJjb25maWcuaXRlbVRlbXBsYXRlXCIgY2xhc3M9XCJnLXRlbXBsYXRlIGctaXRlbS10ZW1wbGF0ZVwiPlxuICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJjb25maWcuaXRlbVRlbXBsYXRlOyBjb250ZXh0OiB7IGluZGV4LCB0eXBlLCBkYXRhLCBpc0FjdGl2ZTogaXNBY3RpdmUgfVwiPlxuICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgPC9uZy1jb250YWluZXI+XG4gIGBcbn0pXG5leHBvcnQgY2xhc3MgR2FsbGVyeUl0ZW1Db21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdDaGVja2VkIHtcblxuICByZWFkb25seSBUeXBlcyA9IEdhbGxlcnlJdGVtVHlwZTtcblxuICAvKiogQSBmbGFnIHRoYXQgZW5zdXJlIHRoYXQgdGhlIGhlaWdodCB3YXMgZW1pdHRlZCBhZnRlciB0YmUgaW1hZ2UgaXMgbG9hZGVkLCB1c2VkIG9ubHkgZm9yIGdhbGxlcnkgaW1hZ2UgdHlwZXMgKi9cbiAgcHJpdmF0ZSBpbWFnZUxvYWRpbmdTdGF0ZTogJ0lOX1BST0dSRVNTJyB8ICdET05FJyA9ICdJTl9QUk9HUkVTUyc7XG5cbiAgLyoqIEdhbGxlcnkgY29uZmlnICovXG4gIEBJbnB1dCgpIGNvbmZpZzogR2FsbGVyeUNvbmZpZztcblxuICAvKiogSXRlbSdzIGluZGV4IGluIHRoZSBnYWxsZXJ5ICovXG4gIEBJbnB1dCgpIGluZGV4OiBudW1iZXI7XG5cbiAgLyoqIEdhbGxlcnkgY3VycmVudCBpbmRleCAqL1xuICBASW5wdXQoKSBjdXJySW5kZXg6IG51bWJlcjtcblxuICAvKiogSXRlbSdzIHR5cGUgJ2ltYWdlJywgJ3ZpZGVvJywgJ3lvdXR1YmUnLCAnaWZyYW1lJyAqL1xuICBASW5wdXQoKSB0eXBlOiBzdHJpbmc7XG5cbiAgLyoqIEl0ZW0ncyBkYXRhLCB0aGlzIG9iamVjdCBjb250YWlucyB0aGUgZGF0YSByZXF1aXJlZCB0byBkaXNwbGF5IHRoZSBjb250ZW50IChlLmcuIHNyYyBwYXRoKSAqL1xuICBASW5wdXQoKSBkYXRhOiBHYWxsZXJ5SXRlbURhdGE7XG5cbiAgLyoqIFN0cmVhbSB0aGF0IGVtaXRzIHdoZW4gYW4gZXJyb3Igb2NjdXJzICovXG4gIEBPdXRwdXQoKSBlcnJvciA9IG5ldyBFdmVudEVtaXR0ZXI8RXJyb3JFdmVudD4oKTtcblxuICBASG9zdEJpbmRpbmcoJ2NsYXNzLmctYWN0aXZlLWl0ZW0nKSBnZXQgaXNBY3RpdmUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaW5kZXggPT09IHRoaXMuY3VyckluZGV4O1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLmdhbGxlcnlJbmRleCcpIGdldCBpc0luZGV4QXR0cigpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmluZGV4O1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLmltYWdlU3RhdGUnKSBnZXQgaW1hZ2VTdGF0ZSgpOiAnSU5fUFJPR1JFU1MnIHwgJ0RPTkUnIHtcbiAgICByZXR1cm4gdGhpcy5pbWFnZUxvYWRpbmdTdGF0ZTtcbiAgfVxuXG4gIGdldCBlbGVtZW50KCk6IEhUTUxFbGVtZW50IHtcbiAgICByZXR1cm4gdGhpcy5lbC5uYXRpdmVFbGVtZW50O1xuICB9XG5cbiAgZ2V0IGlzQXV0b1BsYXkoKTogYm9vbGVhbiB7XG4gICAgaWYgKHRoaXMuaXNBY3RpdmUpIHtcbiAgICAgIGlmICh0aGlzLnR5cGUgPT09IEdhbGxlcnlJdGVtVHlwZS5WaWRlbyB8fCB0aGlzLnR5cGUgPT09IEdhbGxlcnlJdGVtVHlwZS5Zb3V0dWJlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZGVvRGF0YS5hdXRvcGxheTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBnZXQgeW91dHViZVNyYygpOiBzdHJpbmcge1xuICAgIGxldCBhdXRvcGxheTogMSB8IDAgPSAwO1xuICAgIGlmICh0aGlzLmlzQWN0aXZlICYmIHRoaXMudHlwZSA9PT0gR2FsbGVyeUl0ZW1UeXBlLllvdXR1YmUgJiYgKHRoaXMuZGF0YSBhcyBZb3V0dWJlSXRlbURhdGEpLmF1dG9wbGF5KSB7XG4gICAgICBhdXRvcGxheSA9IDE7XG4gICAgfVxuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwodGhpcy5kYXRhLnNyYyk7XG4gICAgdXJsLnNlYXJjaCA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoe1xuICAgICAgd21vZGU6ICd0cmFuc3BhcmVudCcsXG4gICAgICAuLi4odGhpcy5kYXRhIGFzIFlvdXR1YmVJdGVtRGF0YSkucGFyYW1zLFxuICAgICAgYXV0b3BsYXlcbiAgICB9KS50b1N0cmluZygpO1xuICAgIHJldHVybiB1cmwuaHJlZjtcbiAgfVxuXG4gIGdldCBsb2FkKCk6IGJvb2xlYW4ge1xuICAgIHN3aXRjaCAodGhpcy5jb25maWcubG9hZGluZ1N0cmF0ZWd5KSB7XG4gICAgICBjYXNlIExvYWRpbmdTdHJhdGVneS5QcmVsb2FkOlxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIGNhc2UgTG9hZGluZ1N0cmF0ZWd5Lkxhenk6XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJJbmRleCA9PT0gdGhpcy5pbmRleDtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJJbmRleCA9PT0gdGhpcy5pbmRleCB8fCB0aGlzLmN1cnJJbmRleCA9PT0gdGhpcy5pbmRleCAtIDEgfHwgdGhpcy5jdXJySW5kZXggPT09IHRoaXMuaW5kZXggKyAxO1xuICAgIH1cbiAgfVxuXG4gIGdldCBpbWFnZURhdGEoKTogSW1hZ2VJdGVtRGF0YSB7XG4gICAgcmV0dXJuIHRoaXMuZGF0YTtcbiAgfVxuXG4gIGdldCB2aWRlb0RhdGEoKTogVmlkZW9JdGVtRGF0YSB7XG4gICAgcmV0dXJuIHRoaXMuZGF0YTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmKSB7XG4gIH1cblxuICBuZ0FmdGVyVmlld0NoZWNrZWQoKTogdm9pZCB7XG4gICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5nZXRIZWlnaHQoKTtcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tZy1pdGVtLXdpZHRoJywgYCR7IHRoaXMuZ2V0V2lkdGgoKSB9cHhgKTtcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tZy1pdGVtLWhlaWdodCcsIGAkeyBoZWlnaHQgfXB4YCk7XG4gICAgaWYgKHRoaXMuY3VyckluZGV4ID09PSB0aGlzLmluZGV4KSB7XG4gICAgICAvLyBBdXRvLWhlaWdodCBmZWF0dXJlLCBvbmx5IGFsbG93ZWQgd2hlbiBzbGlkaW5nIGRpcmVjdGlvbiBpcyBob3Jpem9udGFsXG4gICAgICBjb25zdCBpc1RodW1iUG9zaXRpb25Ib3Jpem9udGFsOiBib29sZWFuID0gdGhpcy5jb25maWcudGh1bWJQb3NpdGlvbiA9PT0gJ3RvcCcgfHwgdGhpcy5jb25maWcudGh1bWJQb3NpdGlvbiA9PT0gJ2JvdHRvbSc7XG4gICAgICBpZiAodGhpcy5jb25maWcuYXV0b0hlaWdodCAmJiBoZWlnaHQgJiYgaXNUaHVtYlBvc2l0aW9uSG9yaXpvbnRhbCkge1xuICAgICAgICAvLyBDaGFuZ2Ugc2xpZGVyIGhlaWdodFxuICAgICAgICB0aGlzLmVsZW1lbnQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LnN0eWxlLmhlaWdodCA9IGAkeyBoZWlnaHQgfXB4YDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBvbkl0ZW1Mb2FkZWQoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaW1hZ2VMb2FkaW5nU3RhdGUgPT09ICdJTl9QUk9HUkVTUycpIHtcbiAgICAgIHRoaXMuaW1hZ2VMb2FkaW5nU3RhdGUgPSAnRE9ORSc7XG4gICAgICAvLyBEZXRlY3QgY2hhbmdlcyB0byByZS1jYWxjdWxhdGUgaXRlbSBzaXplXG4gICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldFdpZHRoKCk6IG51bWJlciB7XG4gICAgaWYgKHRoaXMuY29uZmlnLnNsaWRpbmdEaXJlY3Rpb24gPT09ICdob3Jpem9udGFsJykge1xuICAgICAgY29uc3QgZmlyc3RFbGVtZW50Q2hpbGQ6IEVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ/LmZpcnN0RWxlbWVudENoaWxkO1xuICAgICAgaWYgKHRoaXMuY29uZmlnLml0ZW1BdXRvc2l6ZSAmJiB0aGlzLmltYWdlTG9hZGluZ1N0YXRlID09PSAnRE9ORScgJiYgZmlyc3RFbGVtZW50Q2hpbGQ/LmNsaWVudFdpZHRoKSB7XG4gICAgICAgIHJldHVybiBmaXJzdEVsZW1lbnRDaGlsZC5jbGllbnRXaWR0aDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xpZW50V2lkdGg7XG4gIH1cblxuICBwcml2YXRlIGdldEhlaWdodCgpOiBudW1iZXIge1xuICAgIGNvbnN0IGZpcnN0RWxlbWVudENoaWxkOiBFbGVtZW50ID0gdGhpcy5lbGVtZW50LmZpcnN0RWxlbWVudENoaWxkO1xuICAgIGlmIChmaXJzdEVsZW1lbnRDaGlsZCkge1xuICAgICAgaWYgKHRoaXMuY29uZmlnLmF1dG9IZWlnaHQpIHtcbiAgICAgICAgaWYgKHRoaXMuaW1hZ2VMb2FkaW5nU3RhdGUgPT09ICdET05FJyAmJiBmaXJzdEVsZW1lbnRDaGlsZC5jbGllbnRIZWlnaHQpIHtcbiAgICAgICAgICByZXR1cm4gZmlyc3RFbGVtZW50Q2hpbGQuY2xpZW50SGVpZ2h0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5jb25maWcuc2xpZGluZ0RpcmVjdGlvbiA9PT0gJ3ZlcnRpY2FsJykge1xuICAgICAgICBpZiAodGhpcy5jb25maWcuaXRlbUF1dG9zaXplICYmIHRoaXMuaW1hZ2VMb2FkaW5nU3RhdGUgPT09ICdET05FJyAmJiBmaXJzdEVsZW1lbnRDaGlsZC5jbGllbnRIZWlnaHQpIHtcbiAgICAgICAgICByZXR1cm4gZmlyc3RFbGVtZW50Q2hpbGQuY2xpZW50SGVpZ2h0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmVsZW1lbnQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LmNsaWVudEhlaWdodDtcbiAgfVxufVxuXG4iXX0=